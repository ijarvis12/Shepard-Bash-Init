#!/usr/bin/env bash

function stop() {
  SOURCES="$(ls -1 /etc/shepard)"
  for source in "$SOURCES"; do
    herd stop "$source"
  done
}

function shutdown() {
  stop
}

trap stop SIGSTOP
trap shutdown SIGPWR

function run() {
  SOURCES="$(ls -1 /etc/shepard)"
  for source in "$SOURCES"; do
     ps="$(cat $source)"
     herd start "$ps"
  done
}

run

while true; do
  sleep 1
done
